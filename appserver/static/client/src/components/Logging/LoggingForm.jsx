import { useDispatch, useSelector } from 'react-redux'
import { useRef, useState } from 'react'

import Form from '../Form/Form'
import { saveLogging } from '../../containers/Configuration/ConfigurationSlice'
import { loggingFields } from './constants'

const LoggingForm = () => {
  const dispatch = useDispatch()
  const { content: data } = useSelector(state => state?.configuration?.logging) || {}
  const formRef = useRef(null)
  const [disableSubmit, setDisableSubmit] = useState(false)

  const handleSubmit = () => {
    if (formRef.current) {
      formRef.current.submitForm()
    }
  }

  return (
    <div style={{ margin: '15px 0' }}>
      <Form
        ref={formRef}
        initialValues={{ loglevel: data.loglevel }}
        onSubmit={(formData) => dispatch(saveLogging(formData))}
        fields={loggingFields}
        setDisableSubmit={setDisableSubmit}
      />
      <button
        className="btn btn--primary"
        disabled={disableSubmit}
        onClick={handleSubmit}
      >
        Save
      </button>
    </div>
  )
}

export default LoggingForm
