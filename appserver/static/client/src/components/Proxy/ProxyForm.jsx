import { useRef, useState } from 'react'
import { useDispatch, useSelector } from 'react-redux'
import { isEmpty } from 'lodash'

import Form from '../Form/Form'
import {
  getInitialValues,
  proxyFields,
  validateProxy
} from './constants'
import { saveProxy } from '../../containers/Configuration/ConfigurationSlice'

const ProxyForm = () => {
  const dispatch = useDispatch()
  const { content: data } = useSelector(state => state?.configuration?.proxy) || {}
  const formRef = useRef(null)
  const [disableSubmit, setDisableSubmit] = useState(false)

  const handleSubmit = () => {
    if (formRef.current) {
      formRef.current.submitForm()
    }
  }

  return !isEmpty(data) && (
    <div>
      <Form
        ref={formRef}
        initialValues={getInitialValues(data)}
        onSubmit={(formData) => dispatch(saveProxy(formData))}
        fields={proxyFields}
        setDisableSubmit={setDisableSubmit}
        validate={validateProxy}
      />
      <button
        className="btn btn--primary"
        disabled={disableSubmit}
        onClick={handleSubmit}
      >
        Save
      </button>
    </div>
  )
}

export default ProxyForm
