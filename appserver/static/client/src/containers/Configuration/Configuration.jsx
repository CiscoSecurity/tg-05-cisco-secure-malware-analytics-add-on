import cx from 'classnames'
import { useDispatch, useSelector } from 'react-redux'
import { useEffect, useState } from 'react'

import {
  ACCOUNT_TAB_INDEX,
  CONFIGURATION_BODY,
  CONFIGURATION_DESCRIPTION,
  CONFIGURATION_TABS,
} from './constants'
import { fetchLogging, fetchProxy } from './ConfigurationSlice'
import PageLoader from '../../components/Loader/PageLoader'

import styles from './Configuration.module.scss'

const Configuration = () => {
  const dispatch = useDispatch()
  const [selectedTab, setSelectedTab] = useState(ACCOUNT_TAB_INDEX)
  const { pending: configurationPending } = useSelector(state => state?.configuration)
  const { pending: accountsPending } = useSelector((state) => state.accounts.accounts)

  useEffect(() => {
    dispatch(fetchProxy())
    dispatch(fetchLogging())
  }, []) //eslint-disable-line

  const isPending = configurationPending || accountsPending

  return (
    <div className={styles.pageContainer}>
      {isPending && <PageLoader defaultStyle="centered" size="medium" />}
      <div className={styles.descriptionContainer}>
        {CONFIGURATION_DESCRIPTION}
      </div>
      <div className={styles.tabsContainer}>
        {CONFIGURATION_TABS.map(({ index, title }) => (
          <div
            key={index}
            tabIndex={index}
            className={cx(
              styles.tabCard,
              'btn-card',
              selectedTab === index && 'btn-card--selected'
            )}
            onClick={() => setSelectedTab(index)}
          >
            <div
              className={cx(
                styles.tabTitle,
                'btn-card__title',
                selectedTab === index && styles['tabTitle--selected']
              )}
            >
              {title}
            </div>
          </div>
        ))}
      </div>
      {CONFIGURATION_BODY[selectedTab]}
    </div>
  )
}

export default Configuration
